!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ReactInputMask=t()}(this,(function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var t=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;function n(e){return Array.prototype.slice.call(e)}function i(e){return(""+e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function a(e){return 3===e.nodeType}var r='<br class="emails-editor-separator" />';function o(e){return!a(e)&&"emails-editor-separator"===e.className}return function(s,l){var c=this,u=void 0===l?{}:l,d=u.className,f=void 0===d?"":d,m=u.emails,p=void 0===m?[]:m;e(this,"adjustSelection",(function(){if(c.isFocused){var e=window.getSelection().anchorNode;if(e&&e!==c.input&&c.input.contains(e)){var t=a(e)?e.parentElement:e;if("emails-editor-separator"===t.className)n(c.input.childNodes).indexOf(t)}requestAnimationFrame(c.adjustSelection)}})),e(this,"getSelection",(function(){var e=n(c.input.childNodes),t=window.getSelection(),i=t.anchorNode,a=t.anchorOffset,r=t.focusNode,s=t.focusOffset;if(!c.input.contains(i))return{start:null,end:null};if(i!==c.input){for(;-1===e.indexOf(i);)i=i.parentNode;a=e.indexOf(i)}if(r!==c.input){for(;-1===e.indexOf(r);)r=r.parentNode;s=e.indexOf(r)}var l=Math.min(a,s),u=Math.max(a,s);return{start:l=e.slice(0,l).filter((function(e){return!o(e)})).length,end:u=e.slice(0,u).filter((function(e){return!o(e)})).length}})),e(this,"setCursorAtEmailIndex",(function(e){var t=document.createRange(),i=window.getSelection(),a=n(c.input.childNodes),r=n(c.input.querySelectorAll(".emails-editor__email"))[e],o=r?a.indexOf(r):a.length-1;t.setStart(c.input,o),t.collapse(!0),i.removeAllRanges(),i.addRange(t)})),e(this,"parseEmails",(function(){return n(c.input.childNodes).reduce((function(e,t){var n=(a(t)?t.textContent:t.innerText).replace(/[\s,]+/," ").split(" ").filter((function(e){return!!e.trim()}));return e.concat(n)}),[])})),e(this,"format",(function(){c.emails=c.parseEmails();var e=n(c.input.childNodes);var o=c.getSelection().start;e.reduce((function(e,t,n){var i=(a(t)?t.textContent:t.innerText).replace(/[\s,]+/," ").split(" ").filter((function(e){return!!e.trim()}));return a(t)&&(o=e.length+i.length-1),e.concat(i)}),[]);var s=c.emails.map((function(e){return'<span contenteditable="false" class="'+["emails-editor__email",function(e){return t.test(e)}(e)?"emails-editor__email--valid":"emails-editor__email--invalid"].join(" ")+'">'+i(e)+'<span class="emails-editor__email-btn-remove"></span></span>'})).join(r);c.input.innerHTML=s?r+s+r:r,n(c.input.querySelectorAll(".emails-editor__email-btn-remove")).forEach((function(e){e.addEventListener("click",c.onEmailRemoveClick)})),c.isFocused&&null!==o&&c.setCursorAtEmailIndex(o+1)})),e(this,"formatIfNeeded",(function(){var e=n(c.input.childNodes).filter((function(e){return a(e)||"emails-editor-separator"!==e.className})).map((function(e){return a(e)?e.textContent:e.innerText})).join("");/[\s,]/.test(e)&&c.format()})),e(this,"onEmailRemoveClick",(function(e){var t=c.getSelection().start,n=e.target.parentElement;c.input.removeChild(n),c.emails=c.parseEmails(),c.format(),t&&c.setCursorAtEmailIndex(t)})),e(this,"onFocus",(function(){c.isFocused=!0,c.adjustSelection()})),e(this,"onBlur",(function(){c.isFocused=!1,c.format()})),e(this,"onKeyDown",(function(e){if(13===e.keyCode)e.preventDefault(),c.format();else if(8===e.keyCode){e.preventDefault();var t=c.getSelection(),n=t.start===t.end,i=[].concat(n?c.emails.slice(0,t.start).slice(0,-1):c.emails.slice(0,t.start),c.emails.slice(t.end));c.input.innerText=i.join(" "),c.format(),c.setCursorAtEmailIndex(t.start)}})),e(this,"onPaste",(function(e){e.preventDefault();var t=e.clipboardData.getData("text"),n=c.getSelection(),a=n.start,r=n.end;c.input.innerHTML=c.input.innerHTML.slice(0,a)+i(t)+c.input.innerHTML.slice(r),c.emails=c.parseEmails(),c.formatIfNeeded()})),e(this,"onInput",(function(){c.emails=c.parseEmails(),c.formatIfNeeded()}));var h=document.createElement("div");h.className=["emails-editor",f].join(" "),h.innerText=p.join(" "),h.contentEditable=!0,h.addEventListener("input",this.onInput),h.addEventListener("paste",this.onPaste),h.addEventListener("click",this.onClick),h.addEventListener("focus",this.onFocus),h.addEventListener("blur",this.onBlur),h.addEventListener("keydown",this.onKeyDown),this.input=h,this.emails=p,this.format(),this.isFocused=!1,s.append(h)}}));
