"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var EMAIL_REGEXP=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;function validateEmail(e){return EMAIL_REGEXP.test(e)}function nodeListToArray(e){return Array.prototype.slice.call(e)}function escapeHtml(e){return(""+e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function styleInject(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&a.firstChild?a.insertBefore(n,a.firstChild):a.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}var css='.emails-editor { background: white; white-space: nowrap; display: flex; flex-wrap: wrap; align-content: flex-start; font-size: 14px; line-height: 24px; padding: 7px 8px 3px; cursor: text; overflow: hidden; }\n.emails-editor__email { position: relative; margin-right: 6px; max-width: 100%; box-sizing: border-box; margin-bottom: 3px; height: 24px; cursor: default; }\n.emails-editor__email-btn-remove { padding-left: 6px; cursor: pointer; font-weight: 300; }\n.emails-editor__email-btn-remove::after { content: "Ã—"; }\n.emails-editor__email--valid { background-color: rgba(102, 152, 255, 0.2); border-radius: 12px; padding-left: 10px; padding-right: 7px; margin-right: 8px; }\n.emails-editor__email--invalid { padding-right: 3px; }\n.emails-editor__email--invalid::after { content: ""; display: block; position: absolute; left: 0; right: 3px; bottom: 0; border-bottom: 1px dashed #d14836; }\n.emails-editor__input { flex-grow: 1; max-width: 100%; font: inherit; height: 24px; margin-bottom: 3px; }\n.emails-editor__width-calculator { white-space: nowrap; font: inherit; position: absolute; visibility: hidden; top: 0; left: 0; }';styleInject(css);var EmailsEditor=function(e,t){var i=this,a=void 0===t?{}:t,n=a.className,r=void 0===n?"":n,l=a.placeholder,o=void 0===l?"":l,d=a.addMorePlaceholder,s=void 0===d?"":d,c=a.emails,u=void 0===c?[]:c,p=a.onChange;_defineProperty(this,"createEmailBlock",(function(e){var t=escapeHtml(e),a=["emails-editor__email",validateEmail(e)?"emails-editor__email--valid":"emails-editor__email--invalid"].join(" "),n=document.createElement("span");return n.className=a,n.innerHTML=t+'<span class="emails-editor__email-btn-remove"></span>',n.querySelector(".emails-editor__email-btn-remove").addEventListener("click",(function(){var e=nodeListToArray(i.container.querySelectorAll(".emails-editor__email")).indexOf(n);i.removeEmailAtIndex(e)})),n})),_defineProperty(this,"addEmail",(function(e){i.emails=[].concat(i.emails,[e]);var t=i.createEmailBlock(e);i.container.insertBefore(t,i.input),i.adjustInputPlaceholder(),i.adjustInputWidth(),i.onChange&&i.onChange(i.getEmails())})),_defineProperty(this,"removeEmailAtIndex",(function(e){i.emails=[].concat(i.emails.slice(0,e),i.emails.slice(e+1));var t=i.container.children[e];i.container.removeChild(t),i.adjustInputPlaceholder(),i.adjustInputWidth(),i.onChange&&i.onChange(i.getEmails())})),_defineProperty(this,"resetEmails",(function(){for(;i.emails.length;)i.removeEmailAtIndex(i.emails.length-1)})),_defineProperty(this,"getEmails",(function(){return i.emails.map((function(e){return{value:e,valid:validateEmail(e)}}))})),_defineProperty(this,"setEmails",(function(e){i.resetEmails(),e.forEach(i.addEmail)})),_defineProperty(this,"adjustInputPlaceholder",(function(){var e=i.placeholder,t=i.addMorePlaceholder;i.emails.length?i.input.placeholder=t:i.input.placeholder=e})),_defineProperty(this,"adjustInputWidth",(function(){var e=i.input,t=e.placeholder,a=e.value;i.widthCalculator.innerText=a;var n=i.widthCalculator.getBoundingClientRect().width;i.widthCalculator.innerText=t;var r=i.widthCalculator.getBoundingClientRect().width,l=Math.max(n,r);i.input.style.width=l+"px"})),_defineProperty(this,"onKeyDown",(function(e){if("Enter"===e.key)i.input.value.trim()&&(i.addEmail(i.input.value),i.input.value="",i.adjustInputWidth());else if("Backspace"===e.key){var t=i.input.selectionEnd>0,a=i.emails.length>0;if(t||!a)return;i.removeEmailAtIndex(i.emails.length-1)}})),_defineProperty(this,"onInput",(function(){/[\s,]/.test(i.input.value)&&(i.input.value.replace(/[\s,]+/," ").trim().split(" ").filter((function(e){return!!e.trim()})).forEach(i.addEmail),i.input.value="");i.adjustInputWidth()})),_defineProperty(this,"onBlur",(function(){i.input.value.trim()&&(i.addEmail(i.input.value),i.input.value="",i.adjustInputWidth())})),_defineProperty(this,"onContainerClick",(function(){i.input.focus()}));var m=document.createElement("input");m.className="emails-editor__input",m.inputMode="email",m.addEventListener("input",this.onInput),m.addEventListener("keydown",this.onKeyDown),m.addEventListener("blur",this.onBlur);var h=document.createElement("div");h.className="emails-editor__width-calculator";var f=document.createElement("div");f.className="emails-editor "+r,f.appendChild(m),f.appendChild(h),f.addEventListener("click",this.onContainerClick),this.input=m,this.widthCalculator=h,this.container=f,this.emails=[],this.placeholder=o,this.addMorePlaceholder=s,this.onChange=p,this.adjustInputPlaceholder(),u.forEach(this.addEmail),e.appendChild(f)};module.exports=EmailsEditor;
